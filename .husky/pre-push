echo "ğŸ” Starting pre-push checks..."

# Configurable protected branch (default: master)
PROTECTED_BRANCH=${PROTECTED_BRANCH:-master}

current_branch=$(git rev-parse --abbrev-ref HEAD)
echo "ğŸ” Current branch: $current_branch"

if [ "$current_branch" != "$PROTECTED_BRANCH" ]; then
  echo "âœ… Not on protected branch ($PROTECTED_BRANCH). Skipping heavy checks."
  exit 0
fi

echo "ğŸ›  Running build..."
npm run build || {
  echo "âŒ Build failed. Please fix before pushing."
  exit 1
}

echo "ğŸ§ª Running tests..."
npm run test || {
  echo "âŒ Tests failed. Please fix before pushing."
  exit 1
}

echo "âœ… Pre-push checks passed."
